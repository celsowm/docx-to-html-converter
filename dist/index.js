var W=Object.defineProperty;var q=(D,t,e)=>t in D?W(D,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):D[t]=e;var H=(D,t,e)=>q(D,typeof t!="symbol"?t+"":t,e);import X from"jszip";import{XMLParser as G}from"fast-xml-parser";var O=class O{constructor(t,e){this.zip=t,this.relationships=null,this.numbering=null,this.globalStyles={},this.docDefaults={pPr:[],rPr:[]},this.listState={stack:[]},this.listCounters={};let i=e||G;this.parser=new i({preserveOrder:!0,ignoreDeclaration:!0,ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"##text",trimValues:!1})}static async create(t,e){if(!t)throw new Error("O arquivo est\xE1 vazio ou corrompido.");let i=await X.loadAsync(t),s=new O(i,e);return await s.loadRelationships(),await s.loadNumbering(),await s.loadStyles(),s}mergeProperties(t=[],e=[]){let i=new Map;return t.forEach(s=>{let r=Object.keys(s)[0];r!==":@"&&i.set(r,s)}),e.forEach(s=>{let r=Object.keys(s)[0];r!==":@"&&i.set(r,s)}),Array.from(i.values())}mergeStyleObjects(t={},e={}){return{pPr:this.mergeProperties(t.pPr,e.pPr),rPr:this.mergeProperties(t.rPr,e.rPr),tblPr:this.mergeProperties(t.tblPr,e.tblPr)}}async loadStyles(){let t=this.zip.file("word/styles.xml");if(!t)return;let e=await t.async("string"),i=this.parser.parse(e),s=this.findChild(i,"w:styles");if(!s)return;let r=this.findChild(s["w:styles"],"w:docDefaults");if(r){let d=this.findChild(r["w:docDefaults"],"w:rPrDefault");if(d){let g=this.findChild(d["w:rPrDefault"],"w:rPr");g&&(this.docDefaults.rPr=g["w:rPr"])}let f=this.findChild(r["w:docDefaults"],"w:pPrDefault");if(f){let g=this.findChild(f["w:pPrDefault"],"w:pPr");g&&(this.docDefaults.pPr=g["w:pPr"])}}let a=this.filterChildren(s["w:styles"],"w:style"),l={};a.forEach(d=>{let f=d[":@"];if(!f||!f["@_w:styleId"])return;let g=f["@_w:styleId"],m=d["w:style"],b=this.findChild(m,"w:pPr"),u=this.findChild(m,"w:rPr"),n=this.findChild(m,"w:tblPr"),c=this.findChild(m,"w:basedOn"),o=this.findChild(m,"w:link"),w=c?c[":@"]["@_w:val"]:null,P=o?o[":@"]["@_w:val"]:null;l[g]={basedOn:w,link:P,pPr:b?b["w:pPr"]:[],rPr:u?u["w:rPr"]:[],tblPr:n?n["w:tblPr"]:[]}});let h=Object.keys(l);for(let d of h)this.resolveStyle(d,l)}resolveStyle(t,e){if(this.globalStyles[t])return this.globalStyles[t];let i=e[t];if(!i)return{pPr:[],rPr:[],tblPr:[]};let s={pPr:[],rPr:[],tblPr:[]};i.basedOn&&(s=this.resolveStyle(i.basedOn,e));let r=this.mergeStyleObjects(s,i);return this.globalStyles[t]=r,r}extractFileNameFromPath(t){let e=t.split(/[\\/]/);return e[e.length-1]}extractAnchorFileName(t){let e=t;try{e=t.split(",")[0].replace(/[^a-zA-Z0-9._-]/g,"")}catch{}return e}async convert(t={extractPageStyles:!0}){let e=this.zip.file("word/document.xml");if(!e)throw new Error("document.xml n\xE3o encontrado.");let i=await e.async("string"),r=this.parser.parse(i).find(n=>n["w:document"]);if(!r)throw new Error("Estrutura inesperada: w:document n\xE3o encontrado.");let a=this.findChild(r["w:document"],"w:body");if(!a)throw new Error("w:body n\xE3o encontrado.");let l=a["w:body"],h=null,d=null;if(t.extractPageStyles){let n=this.findChild(l,"w:sectPr");n&&(h=this.getPageStylesAsObject(n["w:sectPr"]),d=O.formatCssFromStyles(h))}let f=[],g=[],m=this.findChild(l,"w:sectPr"),b=m?m["w:sectPr"]:null;for(let n of l){let c=Object.keys(n)[0];if(c==="w:p"){let o=this.findChild(n["w:p"],"w:pPr");if(o){let w=this.findChild(o["w:pPr"],"w:sectPr");if(w){f.push({children:g,sectPr:w["w:sectPr"]}),g=[];continue}}}c!=="w:sectPr"&&g.push(n)}(g.length>0||f.length===0)&&f.push({children:g,sectPr:b});let u="";for(let n of f){let c=await this.processChildren(n.children),o=this.getSectionStyles(n.sectPr),w=o?` style="${o}"`:"";c.trim()&&(u+=`<div class="docx-section"${w}>${c}</div>`)}return u=u.replace(/<(h[1-6]|p)>\s*<\/\1>/g,"<$1>\xA0</$1>"),{html:`<div class="docx">${u}</div>`,pageStyles:h,pageStylesCss:d}}getPageStylesAsObject(t){if(!t)return null;let e={size:{width:null,height:null,orientation:"portrait"},margin:{top:null,right:null,bottom:null,left:null},units:"pt"},i=this.findChild(t,"w:pgSz");if(i&&i[":@"]){let r=i[":@"],a=parseInt(r["@_w:w"],10)/20,l=parseInt(r["@_w:h"],10)/20;isNaN(a)||(e.size.width=a),isNaN(l)||(e.size.height=l),r["@_w:orient"]==="landscape"&&(e.size.orientation="landscape")}let s=this.findChild(t,"w:pgMar");if(s&&s[":@"]){let r=s[":@"];["top","right","bottom","left"].forEach(l=>{if(r[`@_w:${l}`]){let h=parseInt(r[`@_w:${l}`],10)/20;isNaN(h)||(e.margin[l]=h)}})}return e}static formatCssFromStyles(t){if(!t)return null;let e=[],{size:i,margin:s,units:r}=t;return i.orientation==="landscape"?e.push("size: landscape;"):i.width&&i.height&&e.push(`size: ${i.width}${r} ${i.height}${r};`),Object.keys(s).forEach(a=>{s[a]!==null&&e.push(`margin-${a}: ${s[a]}${r};`)}),e.length>0?`@page { ${e.join(" ")} }`:null}getSectionStyles(t){if(!t)return"";let e="",i=this.findChild(t,"w:cols");if(i&&i[":@"]){let s=parseInt(i[":@"]["@_w:num"],10);if(!isNaN(s)&&s>1){e+=`column-count: ${s};`;let r=i[":@"]["@_w:space"];if(r){let a=parseInt(r,10)/20;e+=` column-gap: ${a}pt;`}}}return e}findChild(t,e){return!t||!Array.isArray(t)?null:t.find(i=>Object.keys(i)[0]===e)}filterChildren(t,e){return!t||!Array.isArray(t)?[]:t.filter(i=>Object.keys(i)[0]===e)}getText(t){return t&&t["##text"]?Array.isArray(t["##text"])?t["##text"].join(""):t["##text"]:""}async loadRelationships(){let t=this.zip.file("word/_rels/document.xml.rels");if(t){let e=await t.async("string"),s=this.parser.parse(e).find(l=>l.Relationships);if(!s)return;let r=s.Relationships;this.relationships={},this.filterChildren(r,"Relationship").forEach(l=>{let h=l[":@"];h&&h["@_Id"]&&(this.relationships[h["@_Id"]]={type:h["@_Type"],target:h["@_Target"]})})}}async loadNumbering(){let t=this.zip.file("word/numbering.xml");if(!t)return;let e=await t.async("string"),s=this.parser.parse(e).find(l=>l["w:numbering"]);if(!s)return;let r=s["w:numbering"],a={};this.filterChildren(r,"w:abstractNum").forEach(l=>{let h=l[":@"]["@_w:abstractNumId"],d=l["w:abstractNum"],f=this.filterChildren(d,"w:lvl"),g={};f.forEach(m=>{var N,C,y;let b=m["w:lvl"],u=m[":@"]["@_w:ilvl"],n=this.findChild(b,"w:numFmt"),c=this.findChild(b,"w:lvlText"),o=this.findChild(b,"w:start"),w=((N=n==null?void 0:n[":@"])==null?void 0:N["@_w:val"])||"decimal",P=((C=c==null?void 0:c[":@"])==null?void 0:C["@_w:val"])||"%1.",$=(y=o==null?void 0:o[":@"])!=null&&y["@_w:val"]?parseInt(o[":@"]["@_w:val"],10):1;g[u]={numFmt:w,lvlText:P,start:$}}),a[h]=g}),this.filterChildren(r,"w:num").forEach(l=>{let h=l[":@"]["@_w:numId"],d=l["w:num"],f=this.findChild(d,"w:abstractNumId");if(f&&f[":@"]){let g=f[":@"]["@_w:val"],m=a[g];this.numbering||(this.numbering={}),this.numbering[h]=m}})}async processChildren(t){let e="";for(let i=0;i<t.length;i++){let s=t[i],r=Object.keys(s)[0];if(!(r.startsWith(":")||r==="##text"))if(r==="w:p"){let a=s["w:p"],l=this.findChild(a,"w:pPr"),h=l?l["w:pPr"]:null,d=null;if(h){let n=this.findChild(h,"w:pStyle");if(n&&n[":@"]){let c=n[":@"]["@_w:val"];d=this.globalStyles[c]}}let f=await this.processParagraphContent(a,d),g=h?this.findChild(h,"w:pBdr"):null;if(g&&this.findChild(g["w:pBdr"],"w:bottom")&&f.trim()===""){e+=this.closeLists()+"<hr>";continue}let b=null,u=null;if(h){let n=this.findChild(h,"w:numPr");if(!n&&d&&d.pPr&&(n=this.findChild(d.pPr,"w:numPr")),n){let c=n["w:numPr"],o=this.findChild(c,"w:numId"),w=this.findChild(c,"w:ilvl");o&&o[":@"]&&w&&w[":@"]&&(b=o[":@"]["@_w:val"],u=w[":@"]["@_w:val"])}}b!==null&&u!==null?e+=this.handleListItem(b,parseInt(u,10),f):(e+=this.closeLists(),f.trim()===""&&!f.includes("\xA0")?e+="<p>\xA0</p>":e+=await this.renderNonListParagraph(a,f))}else r==="w:tbl"&&(e+=this.closeLists(),e+=await this.processTable(s["w:tbl"]))}return e+=this.closeLists(),e}async processParagraphContent(t,e){let i="";for(let s of t){let r=Object.keys(s)[0];r==="w:r"?i+=await this.processRun(s["w:r"],e):r==="w:hyperlink"&&(i+=await this.processHyperlink(s))}return i}getListMeta(t,e){var s,r;let i=(r=(s=this.numbering)==null?void 0:s[t])==null?void 0:r[e];return i?i.numFmt==="bullet"?{tag:"ul",css:"disc",start:i.start||1,lvlText:i.lvlText}:{tag:"ol",css:O.NUMFMT_TO_CSS[i.numFmt]||"decimal",start:i.start||1,lvlText:i.lvlText}:{tag:"ol",css:"decimal",start:1,lvlText:"%1."}}formatListMarker(t,e){let s=this.getListMeta(t,e).lvlText||"%1.";return this.listCounters[t]||(this.listCounters[t]=[]),s=s.replace(/%(\d+)/g,(r,a)=>{var f,g,m;let l=parseInt(a,10)-1,h=this.listCounters[t][l]||1,d=((m=(g=(f=this.numbering)==null?void 0:f[t])==null?void 0:g[l])==null?void 0:m.numFmt)||"decimal";return this.formatCounter(h,d)}),s}formatCounter(t,e){switch(e){case"lowerRoman":return this.toRoman(t).toLowerCase();case"upperRoman":return this.toRoman(t).toUpperCase();case"lowerLetter":return this.toAlpha(t).toLowerCase();case"upperLetter":return this.toAlpha(t).toUpperCase();default:return String(t)}}toRoman(t){let e=[["M",1e3],["CM",900],["D",500],["CD",400],["C",100],["XC",90],["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]],i="";for(let[s,r]of e)for(;t>=r;)i+=s,t-=r;return i}toAlpha(t){let e="";for(;t>0;)t--,e=String.fromCharCode(65+t%26)+e,t=Math.floor(t/26);return e}closeLists(){let t="";for(;this.listState.stack.length;){let e=this.listState.stack.pop();e.openLi&&(t+="</li>"),t+=`</${e.type}>`}return t}isDefaultMarker(t){if(!t||!t.lvlText)return!0;let e=t.lvlText.trim(),i=/^%1[.)]?$/.test(e),s=/%[2-9]/.test(e);return i&&!s}handleListItem(t,e,i){var g,m,b;let s="",r=(g=this.numbering)==null?void 0:g[t];for(;this.listState.stack.length>0&&this.listState.stack[this.listState.stack.length-1].level>e;){let u=this.listState.stack.pop();u.openLi&&(s+="</li>"),s+=`</${u.type}>`}let a=this.listState.stack.length>0?this.listState.stack[this.listState.stack.length-1]:null,l=a?(m=this.numbering)==null?void 0:m[a.numId]:null;if(a&&a.level===e&&r!==l){let u=this.listState.stack.pop();u.openLi&&(s+="</li>"),s+=`</${u.type}>`}for(;this.listState.stack.length<=e;){let u=this.listState.stack.length,n=this.getListMeta(t,u);this.listCounters[t]||(this.listCounters[t]=[]),typeof this.listCounters[t][u]!="number"&&(this.listCounters[t][u]=n.start||1);let c=this.isDefaultMarker(n),o="";n.tag==="ol"&&n.start>1&&(o=` start="${n.start}"`);let w="";c?w=n.css?` style="list-style-type:${n.css};"`:"":w=' style="list-style-type:none; padding-left:1.5em;"',s+=`<${n.tag}${o}${w}>`,this.listState.stack.push({numId:t,level:u,type:n.tag,openLi:!1})}let h=this.listState.stack[e];h.openLi&&(s+="</li>");let d=this.getListMeta(t,e);if(this.isDefaultMarker(d))s+=`<li>${i}`;else{let u=this.formatListMarker(t,e);s+=`<li><span class="docx-marker">${u}</span> ${i}`}if(h.openLi=!0,d.tag==="ol"){this.listCounters[t]||(this.listCounters[t]=[]),this.listCounters[t][e]++;let u=(b=this.numbering)==null?void 0:b[t];if(u)for(let n=e+1;n<Object.keys(u).length;n++){let c=this.getListMeta(t,n);this.listCounters[t]&&(this.listCounters[t][n]=c.start||1)}}return s}async renderNonListParagraph(t,e){let i=this.findChild(t,"w:pPr"),s=i?i["w:pPr"]:null;if(e.trim()==="")return"<p>\xA0</p>";let r=this.getParagraphStyle(s,t);if(s){let a=this.findChild(s,"w:pStyle");if(a&&a[":@"]){let l=a[":@"]["@_w:val"];if(l.match(/^Heading[1-6]$/i)||l.match(/^Ttulo[1-6]$/i)){let h=l.replace(/(heading|Ttulo)/i,"");return`<h${h}${r}>${e}</h${h}>`}else{if(l.match(/title/i))return`<h1${r}>${e}</h1>`;if(l.match(/quote/i))return`<blockquote${r}>${e}</blockquote>`}}}return`<p${r}>${e||"\xA0"}</p>`}getParagraphStyle(t,e=null){var g;let i=((g=this.docDefaults)==null?void 0:g.pPr)||[],s=t?this.findChild(t,"w:pStyle"):null,r=s?s[":@"]["@_w:val"]:null,a=r?this.globalStyles[r]:null,l=a?a.pPr:[],h=t||[],d=this.mergeProperties(this.mergeProperties(i,l),h),f="";if(d){let m=this.findChild(d,"w:jc");if(m&&m[":@"]){let c=m[":@"]["@_w:val"];["left","center","right","both"].includes(c)&&(f+=`text-align: ${c==="both"?"justify":c};`)}let b=this.findChild(d,"w:spacing");if(b&&b[":@"]){let c=b[":@"];if(c["@_w:before"]){let o=parseInt(c["@_w:before"],10);isNaN(o)||(f+=`margin-top: ${o/20}pt;`)}if(c["@_w:after"]){let o=parseInt(c["@_w:after"],10);isNaN(o)||(f+=`margin-bottom: ${o/20}pt;`)}}let u=this.findChild(d,"w:ind");if(u&&u[":@"]){let c=u[":@"];if(c["@_w:left"]){let o=parseInt(c["@_w:left"],10);isNaN(o)||(f+=`margin-left: ${o/20}pt;`)}if(c["@_w:firstLine"]){let o=parseInt(c["@_w:firstLine"],10);isNaN(o)||(f+=`text-indent: ${o/20}pt;`)}if(c["@_w:hanging"]){let o=parseInt(c["@_w:hanging"],10);isNaN(o)||(f+=`padding-left: ${o/20}pt; text-indent: -${o/20}pt;`)}}let n=this.findChild(d,"w:pBdr");if(n){let c=n["w:pBdr"],o=this.findChild(c,"w:bottom");if(o&&o[":@"]){let w=o[":@"],P=parseInt(w["@_w:sz"],10)/8,$=parseInt(w["@_w:space"],10)/20,N=w["@_w:color"]&&w["@_w:color"]!=="auto"?`#${w["@_w:color"]}`:"black",C=w["@_w:val"];!isNaN(P)&&C&&C!=="none"&&(f+=`border-bottom: ${P}pt solid ${N}; padding-bottom: ${$}pt;`)}}}return this.paragraphContainsFloatedImage(e)&&(f+="overflow: auto;"),f?` style="${f}"`:""}paragraphContainsFloatedImage(t){if(!t)return!1;for(let e of t)if(e["w:r"]){let i=e["w:r"],s=this.findChild(i,"w:drawing");if(s){let r=this.findChild(s["w:drawing"],"wp:anchor");if(r){let a=r["wp:anchor"];if(this.findChild(a,"wp:wrapSquare")||this.findChild(a,"wp:wrapTight")||this.findChild(a,"wp:wrapThrough"))return!0}}}return!1}async processRun(t,e){var P;let i=this.findChild(t,"w:drawing");if(i)return await this.processDrawing(i["w:drawing"]);let s="",r=!1;for(let $ of t){let N=Object.keys($)[0];if(N==="w:t"){let C=($["w:t"]||[]).map(T=>T["##text"]||"").join("");C&&(r=!0);let y=$[":@"];y&&y["@_xml:space"]==="preserve"&&(C=C.replace(/^ /,"\xA0").replace(/ $/,"\xA0").replace(/  /g,"\xA0 ")),s+=C.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">")}else N==="w:br"&&(s+="<br>")}if(!r&&!s.includes("<br>"))return s.includes("\xA0")?"\xA0":"";let a=((P=this.docDefaults)==null?void 0:P.rPr)||[],l=e&&e.rPr?e.rPr:[],h=this.findChild(t,"w:rPr"),d=h?h["w:rPr"]:[],f=this.findChild(d,"w:rStyle"),g=f?f[":@"]["@_w:val"]:null,m=g?this.globalStyles[g]:null,b=[];m&&m.link&&this.globalStyles[m.link]&&(b=this.globalStyles[m.link].rPr||[]);let u=m?m.rPr:[],n=this.mergeProperties(a,l);n=this.mergeProperties(n,b),n=this.mergeProperties(n,u),n=this.mergeProperties(n,d);let c="",o="",w="";if(n){this.findChild(n,"w:b")&&(c+="<strong>",o="</strong>"+o),this.findChild(n,"w:i")&&(c+="<em>",o="</em>"+o);let $=[],N="",C="",y=this.findChild(n,"w:u");if(y&&y[":@"]){let p=y[":@"]["@_w:val"];if(p&&p!=="none"){$.push("underline"),p==="double"?N="double":p==="wave"&&(N="wavy");let x=y[":@"]["@_w:color"];x&&x!=="auto"&&(C=`#${x}`)}}let T=this.findChild(n,"w:strike"),S=this.findChild(n,"w:dstrike");if((T||S)&&($.push("line-through"),S&&(N="double")),$.length>0){let p=[$.join(" "),N,C].filter(Boolean).join(" ");w+=`text-decoration: ${p};`}let _=this.findChild(n,"w:vertAlign");if(_&&_[":@"]){let p=_[":@"]["@_w:val"];p==="superscript"?(c+="<sup>",o="</sup>"+o):p==="subscript"&&(c+="<sub>",o="</sub>"+o)}let j=this.findChild(n,"w:color");if(j&&j[":@"]){let p=j[":@"]["@_w:val"];p&&p!=="auto"&&(w+=`color:#${p};`)}let k=this.findChild(n,"w:shd");if(k&&k[":@"]){let p=k[":@"]["@_w:fill"];p&&p!=="auto"&&p!=="clear"&&(w+=`background-color:#${p};`)}let v=this.findChild(n,"w:highlight");if(v&&v[":@"]){let p=v[":@"]["@_w:val"],M={yellow:"#ffff00",green:"#00ff00",cyan:"#00ffff",magenta:"#ff00ff",blue:"#0000ff",red:"#ff0000",darkBlue:"#00008b",darkCyan:"#008b8b",darkMagenta:"#8b008b",darkRed:"#8b0000",darkYellow:"#b5a42e",darkGray:"#a9a9a9",lightGray:"#d3d3d3",black:"#000000",white:"#ffffff"}[p];M&&(w+=`background-color:${M};`)}g==="Hyperlink"&&!w.includes("text-decoration")&&(w+="text-decoration:underline;");let I=this.findChild(n,"w:sz");if(I&&I[":@"]){let p=parseInt(I[":@"]["@_w:val"],10);isNaN(p)||(w+=`font-size:${p/2}pt;`)}let L=this.findChild(n,"w:position");if(L&&L[":@"]){let p=parseInt(L[":@"]["@_w:val"],10);!isNaN(p)&&p>0&&(w+=`padding-bottom: ${p/2}pt; display: inline-block; transform: translateY(${-p/2}pt);`)}this.findChild(n,"w:caps")&&(w+="text-transform:uppercase;"),this.findChild(n,"w:smallCaps")&&(w+="font-variant:small-caps;");let B=this.findChild(n,"w:spacing");if(B&&B[":@"]){let p=B[":@"],x="";if(p["@_w:val"]){let M=parseInt(p["@_w:val"],10);isNaN(M)||(x=(M/20).toFixed(2)+"pt")}x&&(w.includes("letter-spacing")?w=w.replace(/letter-spacing:[^;]+;/,`letter-spacing:${x};`):w+=`letter-spacing:${x};`)}}return w&&(c+=`<span style="${w}">`,o="</span>"+o),c+s+o}mapHyperlinkAnchor(t){let e=t["w:hyperlink"],i=t[":@"]?t[":@"]["@_w:anchor"]:null;if(!i)return{hyperlinkChildren:e,anchorAttr:i,anchorDisplay:null,isExternal:!1};let s=null;for(let a of e)if(Object.keys(a)[0]==="w:r"){let h=a["w:r"],d=this.findChild(h,"w:t");if(d&&(s=this.getText(d["w:t"][0]),s))break}let r=s&&(s.toLowerCase().includes(".docx")||s.toLowerCase().includes(".pdf")||s.toLowerCase().includes(".doc"));return{hyperlinkChildren:e,anchorAttr:i,anchorDisplay:s,isExternal:r}}async processHyperlink(t){if(!t["w:hyperlink"])return"";let e=t[":@"]?t[":@"]["@_r:id"]:null,{hyperlinkChildren:i,anchorAttr:s,anchorDisplay:r,isExternal:a}=this.mapHyperlinkAnchor(t),l="";for(let h of i)Object.keys(h)[0]==="w:r"&&(l+=await this.processRun(h["w:r"]));if(e&&this.relationships&&this.relationships[e]){let h=this.relationships[e];if(h.type.endsWith("/hyperlink")){let d=h.target;if(d&&!d.toLowerCase().startsWith("http"))if(a){let f=this.extractAnchorFileName(r||"");d=`https://www.gov.br/seedoc/shared/${f}`,l=r||f||d}else d=`https://www.gov.br/seedoc/shared/${this.extractFileNameFromPath(h.target)}`;return`<a href="${d}" target="_blank" rel="noopener">${l}</a>`}}if(s){let h=`#${s}`;return l=r||l,`<a href="${h}">${l}</a>`}return l}async processDrawing(t){let e=this.findChild(t,"wp:anchor")||this.findChild(t,"wp:inline");if(!e)return"";let i=e[":@"],s=!!this.findChild(t,"wp:anchor"),r=e["wp:anchor"]||e["wp:inline"],a=this.findChild(r,"a:graphic");if(!a)return"";let l=this.findChild(a["a:graphic"],"a:graphicData");if(!l)return"";let h=this.findChild(l["a:graphicData"],"pic:pic");if(!h)return"";let d=h["pic:pic"],f=this.findChild(d,"pic:blipFill"),g=f?this.findChild(f["pic:blipFill"],"a:blip"):null,m=g?g[":@"]:null,b=m?m["@_r:embed"]||m["@_r:link"]:null;if(!b)return"";let u=this.findChild(d,"pic:nvPicPr"),n=u?this.findChild(u["pic:nvPicPr"],"pic:cNvPr"):null,c=n&&n[":@"]?n[":@"]["@_descr"]||n[":@"]["@_title"]:"",o=b?this.relationships[b]:null;if(!o||!o.type.includes("image"))return"";let w=`word/${o.target}`,P=this.zip.file(w);if(!P)return"";let $=await P.async("base64"),N=this.getMimeType(o.target),C="max-width:100%;height:auto;";if(s){let y=this.findChild(r,"wp:wrapSquare"),T=this.findChild(r,"wp:wrapTopAndBottom");if(y?C+="float:left;":T&&(C+="clear:both;"),i){let S=j=>j/12700,_=i;_["@_distL"]&&(C+=`margin-left: ${S(parseInt(_["@_distL"],10))}pt;`),_["@_distR"]&&(C+=`margin-right: ${S(parseInt(_["@_distR"],10))}pt;`),_["@_distT"]&&(C+=`margin-top: ${S(parseInt(_["@_distT"],10))}pt;`),_["@_distB"]&&(C+=`margin-bottom: ${S(parseInt(_["@_distB"],10))}pt;`)}}return`<img src="data:${N};base64,${$}" alt="${c}" style="${C}" />`}parseWidth(t){if(!t||!t[":@"])return"";let e=t[":@"],i=e["@_w:type"]||"dxa",s=parseInt(e["@_w:w"],10);return isNaN(s)?"":i==="pct"?`width: ${s/50}%;`:i==="dxa"?`width: ${s/20}pt;`:i==="auto"?"width: auto;":""}parseBorder(t){if(!t||!t[":@"])return null;let e=t[":@"],i=e["@_w:val"];if(!i||i==="none"||i==="nil")return null;let s=(parseInt(e["@_w:sz"],10)||4)/8,r=e["@_w:color"]&&e["@_w:color"]!=="auto"?`#${e["@_w:color"]}`:"black",l={single:"solid",dashed:"dashed",dotted:"dotted",double:"double"}[i]||i;return`${s}pt ${l} ${r}`}cssFromBorders(t){let e="";return["top","left","bottom","right"].forEach(s=>{let r=this.findChild(t["w:tblBorders"],`w:${s}`),a=this.parseBorder(r);a&&(e+=`border-${s}: ${a};`)}),e}parseCellBorders(t){let e={};if(!t)return e;let i=this.findChild(t,"w:tcBorders");return i&&["top","left","bottom","right"].forEach(r=>{let a=this.findChild(i["w:tcBorders"],`w:${r}`),l=this.parseBorder(a);l&&(e[`border-${r}`]=l)}),e}async processTable(t){let e=this.findChild(t,"w:tblPr"),i=e?e["w:tblPr"]:[],s=i,r=this.findChild(i,"w:tblStyle");if(r&&r[":@"]){let n=r[":@"]["@_w:val"],c=this.globalStyles[n];c&&c.tblPr&&(s=this.mergeProperties(c.tblPr,i))}let a="border-collapse: collapse;",l=this.findChild(s,"w:tblW");l&&(a+=this.parseWidth(l));let h=null,d=null,f=this.findChild(s,"w:tblBorders");if(f){a+=this.cssFromBorders(f);let n=this.findChild(f["w:tblBorders"],"w:insideH");h=this.parseBorder(n);let c=this.findChild(f["w:tblBorders"],"w:insideV");d=this.parseBorder(c)}let g="",m=this.findChild(t,"w:tblGrid");if(m){let n=this.filterChildren(m["w:tblGrid"],"w:gridCol");if(n.length>0){g+="<colgroup>";for(let c of n){let o=this.parseWidth(c);g+=`<col${o?` style="${o}"`:""}>`}g+="</colgroup>"}}let b=`<table border='1' style='${a}'>${g}`,u=this.filterChildren(t,"w:tr");for(let n=0;n<u.length;n++){let o=u[n]["w:tr"];b+="<tr>";let w=this.filterChildren(o,"w:tc");for(let P=0;P<w.length;P++){let N=w[P]["w:tc"],C=this.findChild(N,"w:tcPr"),y=C?C["w:tcPr"]:[];if(y){let k=this.findChild(y,"w:hMerge");if(k&&(!k[":@"]||k[":@"]["@_w:val"]!=="restart"))continue;let v=this.findChild(y,"w:vMerge");if(v&&(!v[":@"]||v[":@"]&&v[":@"]["@_w:val"]!=="restart"))continue}let T="",S={"vertical-align":"top",padding:"4px"};if(h&&n<u.length-1&&(S["border-bottom"]=h),d&&P<w.length-1&&(S["border-right"]=d),y){let k=this.findChild(y,"w:gridSpan");if(k&&k[":@"]){let p=parseInt(k[":@"]["@_w:val"],10);!isNaN(p)&&p>1&&(T+=` colspan="${p}"`)}let v=this.findChild(y,"w:vMerge");if(v&&v[":@"]&&v[":@"]["@_w:val"]==="restart"){let p=1;for(let x=n+1;x<u.length;x++){let M=u[x]["w:tr"],R=this.filterChildren(M,"w:tc")[P];if(R){let V=R["w:tc"],z=this.findChild(V,"w:tcPr"),E=z?z["w:tcPr"]:[],F=E?this.findChild(E,"w:vMerge"):null;if(F&&(!F[":@"]||F[":@"]&&F[":@"]["@_w:val"]!=="restart"))p++;else break}else break}p>1&&(T+=` rowspan="${p}"`)}let I=this.findChild(y,"w:tcW");if(I){let p=this.parseWidth(I);p&&(S.width=p.replace("width:",""))}let L=this.findChild(y,"w:shd");if(L&&L[":@"]){let p=L[":@"]["@_w:fill"];p&&p!=="auto"&&p!=="clear"&&(S["background-color"]=`#${p}`)}let B=this.parseCellBorders(y);Object.assign(S,B)}let _=await this.processChildren(N),j=Object.entries(S).map(([k,v])=>`${k}:${v}`).join(";");b+=`<td${T} style="${j}">${_||"\xA0"}</td>`}b+="</tr>"}return b+="</table>",b}getMimeType(t){switch(t.split(".").pop().toLowerCase()){case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"bmp":return"image/bmp";case"svg":return"image/svg+xml";case"wmf":return"image/wmf";case"emf":return"image/emf";default:return"application/octet-stream"}}};H(O,"NUMFMT_TO_CSS",{decimal:"decimal",decimalZero:"decimal",lowerRoman:"lower-roman",upperRoman:"upper-roman",lowerLetter:"lower-alpha",upperLetter:"upper-alpha",bullet:"disc"});var A=O;var et=A;export{A as DocxToHtmlConverter,et as default};
//# sourceMappingURL=index.js.map